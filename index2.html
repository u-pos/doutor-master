<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>ã‚¹ã‚­ãƒ«ãƒã‚§ãƒƒã‚¯ã‚²ãƒ¼ãƒ </title>
<style>
Â  :root{ --bg:#0f1115; --fg:#eaeef2; }
Â  html,body{
Â  Â  margin:0;height:100%;
Â  Â  background:var(--bg);color:var(--fg);
Â  Â  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
Â  Â  overscroll-behavior:none;touch-action:none;-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;
Â  }
Â  header.title{width:100%;display:flex;justify-content:center;align-items:center;
Â  Â  padding:8px 6px;margin:0;background:#0b1220;border-bottom:1px solid #1f2b3a}
Â  header.title h1{margin:0;font-size:clamp(18px,4.3vw,24px);font-weight:900;color:#9bd5ff}

Â  .wrap{min-height:calc(100dvh - 48px);display:flex;flex-direction:column;align-items:center;gap:4px;padding:4px 6px 2px}

Â  .board{width:100%;max-width:720px;position:relative}
Â  #cv{width:100%;height:100%;display:block;background:#0b0e13;border-radius:12px}

Â  /* ãƒŸãƒ¥ãƒ¼ãƒˆï¼ˆå††ã®å·¦ä¸Šå›ºå®šï¼‰ */
Â  #muteBtn{
Â  Â  position:absolute;top:6px;left:6px;z-index:5;
Â  Â  width:40px;height:40px;font-size:20px;line-height:1;text-align:center;
Â  Â  border-radius:8px;border:1px solid #26303a;background:#1f2937;color:#eaeef2;cursor:pointer;
Â  }

  /* â–¼â–¼â–¼ å¤‰æ›´ç‚¹ â–¼â–¼â–¼ */
Â  .overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:3;font-weight:900;
Â  Â  font-size:clamp(26px,7.5vw,52px);background:rgba(0,0,0,.25);backdrop-filter:saturate(120%) blur(1px);text-align:center;
    padding-top: 15%; /* â† è¿½åŠ : ã€ŒReady Go!ã€ã®è¡¨ç¤ºã‚’å°‘ã—ä¸‹ã«ãšã‚‰ã—ã¾ã™ */
  }
  /* â–²â–²â–² å¤‰æ›´ã“ã“ã¾ã§ â–²â–²â–² */
  
Â  .overlay.show{display:flex}
Â  .welcome{position:absolute;inset:0;display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;z-index:2;
Â  Â  text-align:center;background:rgba(0,0,0,.25)}
Â  .welcome h2{margin:0;font-size:clamp(22px,6.6vw,40px);padding-top:30px;font-weight:900;color:#c8ffe0}

Â  /* TAPã‚’å°‘ã—ä¸Šã¸ã€ä¸‹ã«å°‘ã—ä½™ç™½ */
Â  .tap-row{width:100%;max-width:820px;margin-top:-10px;display:flex;justify-content:center}
Â  #tapBtn{
Â  Â  width:min(92%,620px);height:92px;margin-bottom:10px;
Â  Â  border:2px solid #334155;border-radius:16px;background:#0f131a;
Â  Â  font-weight:900;font-size:clamp(20px,6vw,30px);color:#e5e7eb;cursor:pointer;-webkit-tap-highlight-color:transparent;
Â  }
Â  #tapBtn[disabled]{opacity:.45;cursor:not-allowed}

Â  .bar{display:flex;justify-content:center;gap:8px}
Â  .btn{border:1px solid #26303a;background:#1f2937;color:#fff;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer}
Â  #startBtn{background:#10b981;border-color:#065f46;color:#062e26}

Â  #persecutionWrap{display:flex;justify-content:center;gap:8px}
Â  #persecutionBtn{display:none;background:#ef4444;color:#fff;border-radius:12px;padding:12px 16px}
Â  #rankPerBtn{display:none}

Â  dialog{border:none;border-radius:12px;padding:0;max-width:520px;width:90vw;background:#0f131a;color:#fff}
Â  .dlg-head{padding:12px 14px;border-bottom:1px solid #253040;font-weight:700}
Â  .rank-list{width:100%;border-collapse:collapse}
Â  .rank-list th,.rank-list td{padding:8px 6px;border-bottom:1px solid #1d2533;text-align:left}
</style>
</head>
<body>
Â  <header class="title" id="hdr"><h1>ã‚¹ã‚­ãƒ«ãƒã‚§ãƒƒã‚¯ã‚²ãƒ¼ãƒ </h1></header>

Â  <div class="wrap">
Â  Â  <div class="board" id="board">
Â  Â  Â  <canvas id="cv"></canvas>
Â  Â  Â  <button id="muteBtn" aria-label="ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡æ›¿">ğŸ”Š</button>
Â  Â  Â  <div id="welcome" class="welcome"><h2>ç›®æŒ‡ã› 50å›ï¼</h2></div>
Â  Â  Â  <div id="overlay" class="overlay"></div>
Â  Â  </div>

Â  Â  <div class="tap-row" id="tapRow"><button id="tapBtn" disabled>TAP</button></div>

Â  Â  Â  Â  <div class="bar" id="btnBar">
Â  Â  Â  <button id="startBtn" class="btn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
Â  Â  Â  <button id="rankNormalBtn" class="btn">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé€šå¸¸ï¼‰</button>
Â  Â  </div>

Â  Â  Â  Â  <div id="persecutionWrap">
Â  Â  Â  <button id="persecutionBtn" class="btn">âš  è¿«å®³ãƒ¢ãƒ¼ãƒ‰</button>
Â  Â  Â  <button id="rankPerBtn" class="btn">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆè¿«å®³ï¼‰</button>
Â  Â  </div>
Â  </div>

Â  Â  <dialog id="rankDlg">
Â  Â  <div class="dlg-head" id="rankTitle">ğŸ† è‡ªå·±ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰</div>
Â  Â  <div class="dlg-body">
Â  Â  Â  <table class="rank-list"><thead><tr><th>#</th><th>æ—¥ä»˜</th><th>é€£ç¶šå›æ•°</th></tr></thead><tbody id="rankTbody"></tbody></table>
Â  Â  Â  <div style="display:flex;justify-content:flex-end;gap:8px;margin:10px 14px 14px"><button id="closeRank" class="btn">é–‰ã˜ã‚‹</button></div>
Â  Â  </div>
Â  </dialog>

<script>
(() => {
Â  // ===== è¨­å®šï¼ˆå®‰å®šå‹•ä½œã®ä»•æ§˜ï¼‰ =====
Â  const CONFIG = {
Â  Â  RPM: 60,
Â  Â  INPUT_CD_MS: 45,
Â  Â  NEXT_MIN_DEG: 180,
Â  Â  NEXT_MAX_DEG: 220,
Â  Â  COUNTDOWN_MS: 1500,
Â  Â  TARGET_STREAK: 50,
Â  Â  NORMAL_ZONE: 0.10,
Â  Â  PERSECUTE_ZONE: 0.06,
Â  Â  HIT_EPSILON_DEG: 1.5
Â  };

Â  // ===== è¦ç´  =====
Â  const $=id=>document.getElementById(id);
Â  const hdr=$('hdr'), board=$('board'), cv=$('cv'), ctx=cv.getContext('2d',{alpha:false,desynchronized:true});
Â  const tapRow=$('tapRow'), btnBar=$('btnBar'), persecutionWrap=$('persecutionWrap');
Â  const tapBtn=$('tapBtn'), startBtn=$('startBtn'), perBtn=$('persecutionBtn');
Â  const rankNormalBtn=$('rankNormalBtn'), rankPerBtn=$('rankPerBtn');
Â  const muteBtn=$('muteBtn'), overlay=$('overlay'), welcome=$('welcome');
Â  const rankDlg=$('rankDlg'), rankTbody=$('rankTbody'), rankTitle=$('rankTitle'), closeRank=$('closeRank');

Â  // ===== çŠ¶æ…‹ =====
Â  let phase='idle', streak=0, lastInputAt=0, rafId=0, isMuted=false, showNeedle=true;
Â  let mode='normal', currentZoneRatio=CONFIG.NORMAL_ZONE;
Â  const FULL=Math.PI*2;
Â  const zoneSize=()=>FULL*currentZoneRatio;
Â  let baseAngle=0, baseTime=0, frozenAngle=0, zoneStart=0;
Â  let lastAngle=null, lastInside=false;

Â  // ===== ç”»é¢é«˜ãƒ•ã‚£ãƒƒãƒˆï¼ˆãƒœã‚¿ãƒ³ãŒéš ã‚Œãªã„ï¼‰ =====
Â  function visualH(){ return (window.visualViewport?.height) || window.innerHeight; }
Â  function fitBoardToViewport(){
Â  Â  const vh=visualH(), headH=hdr.offsetHeight, tapH=tapRow.offsetHeight, barH=btnBar.offsetHeight;
Â  Â  const perH=(persecutionWrap.offsetHeight||0) * ((perBtn.style.display!=='none'||rankPerBtn.style.display!=='none')?1:0);
Â  Â  const reserve=headH+tapH+barH+perH+12;
Â  Â  const idealSide=Math.min(board.clientWidth||board.getBoundingClientRect().width||320, Math.max(160, vh-reserve));
Â  Â  board.style.height=idealSide+'px';
Â  }
Â  let cssW=0, cssH=0, dpr=1;
Â  function resizeCanvas(){
Â  Â  fitBoardToViewport();
Â  Â  const rect=cv.getBoundingClientRect();
Â  Â  dpr=Math.max(1, Math.min(3, window.devicePixelRatio||1));
Â  Â  cssW=rect.width||300; cssH=rect.height||300;
Â  Â  cv.width=Math.round(cssW*dpr); cv.height=Math.round(cssH*dpr);
Â  Â  ctx.setTransform(dpr,0,0,dpr,0,0);
Â  Â  draw(getCurrentAngle(performance.now()));
Â  }
Â  window.addEventListener('resize', resizeCanvas);
Â  window.addEventListener('orientationchange', resizeCanvas);
Â  window.visualViewport?.addEventListener('resize', resizeCanvas);
Â  requestAnimationFrame(resizeCanvas);

Â  // ===== ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«/ã‚¸ã‚§ã‚¹ãƒãƒ£æŠ‘æ­¢ =====
Â  document.addEventListener('touchmove',(e)=>e.preventDefault(),{passive:false});
Â  ['gesturestart','gesturechange','gestureend','dblclick'].forEach(ev=>document.addEventListener(ev,(e)=>e.preventDefault(),{passive:false}));

Â  // ===== ã‚µã‚¦ãƒ³ãƒ‰ï¼ˆWebAudioï¼‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰=====
Â  const AudioCtx=window.AudioContext||window.webkitAudioContext;
Â  let actx=null,gMaster=null;
Â  const buf={success:null,bomb:null,ready:null,fanfare:null};
Â  const html={};['success','bomb','ready','fanfare'].forEach(k=>{const a=new Audio(`${k}.mp3`);a.preload='auto';a.playsInline=true;html[k]=a;});
Â  async function unlockAndWarmAudio(){
Â  Â  try{
Â  Â  Â  if(!actx){ actx=new AudioCtx({latencyHint:'interactive'}); gMaster=actx.createGain(); gMaster.gain.value=isMuted?0:1; gMaster.connect(actx.destination);}
Â  Â  Â  if(actx.state==='suspended') await actx.resume();
Â  Â  Â  await Promise.all(Object.keys(buf).map(async k=>{ if(buf[k]) return; const res=await fetch(`${k}.mp3`); const ab=await res.arrayBuffer(); buf[k]=await actx.decodeAudioData(ab); }));
Â  Â  }catch{}
Â  }
Â  function setMuted(m){ isMuted=m; if(gMaster) gMaster.gain.value=m?0:1; Object.values(html).forEach(a=>a.muted=m); muteBtn.textContent=m?'ğŸ”‡':'ğŸ”Š'; }
Â  function playBuf(key,gain=0.95){ try{ if(!actx||!buf[key]) return false; const src=actx.createBufferSource(); const g=actx.createGain(); g.gain.value=gain; src.buffer=buf[key]; src.connect(g).connect(gMaster||actx.destination); src.start(); return true;}catch{return false} }
Â  function playSE(key){ if(isMuted) return; if(playBuf(key)) return; unlockAndWarmAudio(); const tag=html[key]; if(tag){ try{ tag.currentTime=0; tag.play(); }catch{} } }
Â  window.addEventListener('pointerdown', ()=>{ unlockAndWarmAudio(); }, {once:true});

Â  // ===== è§’åº¦/æç”»ï¼ˆå††ã¯ä¿‚æ•°0.42ã§å…ƒã‚µã‚¤ã‚ºï¼‰=====
Â  const norm=a=>(a%FULL+FULL)%FULL;
Â  const inRange=(a,s,e)=>(s<=e)?(a>=s&&a<=e):(a>=s||a<=e);
Â  const cwDelta=(f,t)=>(t-f+FULL)%FULL;
Â  const angleAt=t=>{ const rps=CONFIG.RPM/60; const d=(t-baseTime)/1000; return norm(baseAngle + rps*FULL*d); };
Â  const getCurrentAngle=t=>(phase==='play')?angleAt(t):frozenAngle;

Â  function draw(angle){
Â  Â  const w=cssW,h=cssH,CX=w/2,CY=h/2, r=Math.min(w,h)*0.42;
Â  Â  const ZS=zoneSize();
Â  Â  ctx.clearRect(0,0,w,h);
Â  Â  // å¤–æ 
Â  Â  ctx.beginPath(); ctx.arc(CX,CY,r,0,FULL); ctx.lineWidth=2; ctx.strokeStyle='#1a2330'; ctx.stroke();
Â  Â  // ç™½ã‚¾ãƒ¼ãƒ³
Â  Â  ctx.beginPath(); ctx.lineWidth=24; ctx.strokeStyle='#ffffff';
Â  Â  ctx.arc(CX,CY,r,zoneStart,zoneStart+ZS); ctx.stroke();
Â  Â  
Â  Â  if(showNeedle){
Â  Â  Â  // èµ¤ã„é‡ï¼ˆç›´ç·šãƒ»çŸ­ã„å´0ï¼‰
Â  Â  Â  const fx=CX+r*1.2*Math.cos(angle), fy=CY+r*1.2*Math.sin(angle);
Â  Â  Â  ctx.beginPath(); ctx.moveTo(CX,CY); ctx.lineTo(fx,fy);
Â  Â  Â  ctx.lineWidth=6; ctx.lineCap='butt'; ctx.strokeStyle='#ef4444'; ctx.stroke();
Â  Â  }
Â  Â  
Â  Â  // ã‚³ãƒ³ãƒœï¼ˆä¸­å¿ƒã‚ˆã‚Šå°‘ã—ä¸Šï¼‰
Â  Â  const combo=String(streak);
Â  Â  ctx.save(); ctx.textAlign='center'; ctx.textBaseline='middle';
Â  Â  ctx.font=`900 ${Math.max(18,Math.round(r*0.32))}px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif`;
Â  Â  ctx.lineWidth=Math.max(2,Math.round(r*0.04)); ctx.strokeStyle='rgba(0,0,0,0.55)'; ctx.strokeText(combo,CX,CY-r*0.18);
Â  Â  ctx.fillStyle='#eaeef2'; ctx.fillText(combo,CX,CY-r*0.18); ctx.restore();
Â  }

Â  // ===== ãƒ«ãƒ¼ãƒ— =====
Â  function loop(now){
Â  Â  const ang=getCurrentAngle(now);
Â  Â  draw(ang);
Â  Â  if(phase==='play'){
Â  Â  Â  const ZS=zoneSize(), end=norm(zoneStart+ZS);
Â  Â  Â  const inside=inRange(ang,zoneStart,end);
Â  Â  Â  if(lastAngle!==null && lastInside && !inside){
Â  Â  Â  Â  const moved=cwDelta(lastAngle,ang), toEnd=cwDelta(lastAngle,end);
Â  Â  Â  Â  if(moved>=toEnd){ return gameOver(); }
Â  Â  Â  }
Â  Â  Â  lastInside=inside; lastAngle=ang;
Â  Â  }
Â  Â  rafId=requestAnimationFrame(loop);
Â  }

Â  // ===== åˆ¤å®šï¼ˆe.timeStampï¼‹å¾®å°è¨±å®¹ï¼‰=====
Â  function tapTimestamp(e){
Â  Â  const ts=(e&&typeof e.timeStamp==='number')?e.timeStamp:performance.now();
Â  Â  return (Math.abs(ts - performance.now()) < 10000) ? ts : performance.now();
Â  }

Â  // ===== ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ =====
Â  function setupInitial(){
Â  Â  const center=Math.random()*FULL, ZS=zoneSize();
Â  Â  zoneStart = norm(center - ZS/2);
Â  Â  frozenAngle = norm(center + Math.PI);
Â  Â  lastInside=false; lastAngle=null;
Â  Â  resizeCanvas();
Â  }
Â  function moveZoneAfterSuccess(a){
Â  Â  const min=CONFIG.NEXT_MIN_DEG*Math.PI/180, max=CONFIG.NEXT_MAX_DEG*Math.PI/180;
Â  Â  const nextCenter=norm(a + (min + Math.random()*(max-min)));
Â  Â  const ZS=zoneSize();
Â  Â  zoneStart=norm(nextCenter - ZS/2);
Â  Â  lastInside=false; lastAngle=null;
Â  }

Â  function onTap(e){
Â  Â  if(phase!=='play') return;
Â  Â  const now=tapTimestamp(e);
Â  Â  if(now-lastInputAt<CONFIG.INPUT_CD_MS) return;
Â  Â  lastInputAt=now;

Â  Â  const a=angleAt(now), ZS=zoneSize(), end=norm(zoneStart+ZS);
Â  Â  const EPS=CONFIG.HIT_EPSILON_DEG*Math.PI/180;
Â  Â  const ok = inRange(a, zoneStart, end) || cwDelta(end, a) <= EPS;

Â  Â  if(ok){
Â  Â  Â  playSE('success');
Â  Â  Â  streak++;
Â  Â  Â  if(streak>=CONFIG.TARGET_STREAK){ return celebrateAndUnlock(); }
Â  Â  Â  baseAngle=a; baseTime=now; moveZoneAfterSuccess(a); draw(a);
Â  Â  }else{
Â  Â  Â  gameOver();
Â  Â  }
Â  }

Â  function showCountdown(){
Â  Â  overlay.classList.add('show'); overlay.textContent='Ready';
Â  Â  tapBtn.disabled=true; phase='countdown';
Â  Â  const t0=performance.now(), mid=t0+CONFIG.COUNTDOWN_MS*0.6, end=t0+CONFIG.COUNTDOWN_MS;
Â  Â  const tick=()=>{
Â  Â  Â  const now=performance.now();
Â  Â  Â  if(now>=end){
Â  Â  Â  Â  overlay.classList.remove('show');
Â  Â  Â  Â  baseAngle=frozenAngle; baseTime=now;
Â  Â  Â  Â  phase='play'; tapBtn.disabled=false;
Â  Â  Â  Â  const ang=angleAt(now), ZS=zoneSize();
Â  Â  Â  Â  lastAngle=ang; lastInside=inRange(ang, zoneStart, norm(zoneStart+ZS));
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if(now>=mid) overlay.textContent='GO!';
Â  Â  Â  requestAnimationFrame(tick);
Â  Â  };
Â  Â  requestAnimationFrame(tick);
Â  }

Â  function startGame(which){
Â  Â  showNeedle = true;
Â  Â  mode=which;
Â  Â  currentZoneRatio=(mode==='persecution')?CONFIG.PERSECUTE_ZONE:CONFIG.NORMAL_ZONE;
Â  Â  welcome.style.display='none';
Â  Â  playSE('ready'); unlockAndWarmAudio();
Â  Â  if(rafId) cancelAnimationFrame(rafId);
Â  Â  streak=0; setupInitial(); showCountdown(); rafId=requestAnimationFrame(loop);
Â  }

  /* â–¼â–¼â–¼ å¤‰æ›´ç‚¹ â–¼â–¼â–¼ */
Â  function gameOver(){
Â  Â  playSE('bomb');
Â  Â  showNeedle = false; // é‡ã‚’éè¡¨ç¤ºã«ã™ã‚‹
Â  Â  stopGame(true);
Â  Â  // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ãŸ
Â  Â  draw(frozenAngle); // é‡ãŒæ¶ˆãˆãŸçŠ¶æ…‹ã‚’å³æ™‚åæ˜ ã•ã›ã‚‹
Â  Â  saveScore({score:streak, at:Date.now()});
Â  Â  updateUnlockVisibility();
Â  }
  /* â–²â–²â–² å¤‰æ›´ã“ã“ã¾ã§ â–²â–²â–² */

Â  function stopGame(keepOverlay){
Â  Â  phase='idle'; tapBtn.disabled=true;
Â  Â  if(rafId) cancelAnimationFrame(rafId);
Â  Â  if(!keepOverlay) overlay.classList.remove('show');
Â  }

Â  function celebrateAndUnlock(){
Â  Â  stopGame(true);
Â  Â  playSE('fanfare');
Â  Â  overlay.innerHTML='ãŠã‚ã§ã¨ã†!!<br>50å›é”æˆã ã‚ˆ ğŸ‰<br>è¿«å®³ãƒ¢ãƒ¼ãƒ‰è§£æ”¾ï¼';
Â  Â  overlay.classList.add('show');
Â  Â  try{ localStorage.setItem('skillcheck_unlock_persecution','1'); }catch{}
Â  Â  updateUnlockVisibility();
Â  Â  saveScore({score:streak, at:Date.now()});
Â  }

Â  // ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé€šå¸¸ï¼è¿«å®³ åˆ¥ä¿å­˜ï¼‰=====
Â  const KEY_NORMAL='rank_normal_v2';
Â  const KEY_PERÂ  Â ='rank_per_v2';
Â  function loadScores(key){ try{ return JSON.parse(localStorage.getItem(key)||'[]'); }catch{return []} }
Â  function saveScore(entry){
Â  Â  const key=(mode==='persecution')?KEY_PER:KEY_NORMAL;
Â  Â  if(entry.score<=0) return;
Â  Â  const arr=loadScores(key); arr.push(entry);
Â  Â  arr.sort((a,b)=> b.score-a.score || b.at-a.at);
Â  Â  localStorage.setItem(key, JSON.stringify(arr.slice(0,5)));
Â  }
Â  function openRanking(which){
Â  Â  const key=(which==='persecution')?KEY_PER:KEY_NORMAL;
Â  Â  const arr=loadScores(key);
Â  Â  rankTbody.innerHTML='';
Â  Â  arr.forEach((e,i)=>{
Â  Â  Â  const d=new Date(e.at);
Â  Â  Â  const date=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
Â  Â  Â  const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${date}</td><td>${e.score}</td>`;
Â  Â  Â  rankTbody.appendChild(tr);
Â  Â  });
Â  Â  rankTitle.textContent=(which==='persecution')?'ğŸ† è‡ªå·±ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ï¼ˆè¿«å®³ãƒ¢ãƒ¼ãƒ‰ï¼‰':'ğŸ† è‡ªå·±ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰';
Â  Â  rankDlg.showModal();
Â  }

Â  // ===== ãƒœã‚¿ãƒ³å¯è¦–åˆ¶å¾¡ï¼ˆè§£æ”¾å‰ã¯è¿«å®³ç³»ã‚’éš ã™ï¼‰=====
Â  function isUnlocked(){ try{ return localStorage.getItem('skillcheck_unlock_persecution')==='1'; }catch{ return false; } }
Â  function updateUnlockVisibility(){
Â  Â  const unlocked=isUnlocked();
Â  Â  perBtn.style.display = unlocked ? 'inline-block' : 'none';
Â  Â  rankPerBtn.style.display = unlocked ? 'inline-block' : 'none';
Â  Â  requestAnimationFrame(resizeCanvas);
Â  }

Â  // ===== ã‚¤ãƒ™ãƒ³ãƒˆ =====
Â  startBtn.addEventListener('click', e=>{ e.preventDefault(); startGame('normal'); }, {passive:false});
Â  perBtnÂ  .addEventListener('click', e=>{ e.preventDefault(); startGame('persecution'); }, {passive:false});
Â  tapBtnÂ  .addEventListener('pointerdown', e=>{ e.preventDefault(); onTap(e); }, {passive:false});
Â  window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); onTap(e); } });

Â  muteBtn.addEventListener('click', e=>{ e.preventDefault(); setMuted(!isMuted); }, {passive:false});
Â  $('rankNormalBtn').addEventListener('click', e=>{ e.preventDefault(); openRanking('normal'); }, {passive:false});
Â  $('rankPerBtn')Â  Â  .addEventListener('click', e=>{ e.preventDefault(); openRanking('persecution'); }, {passive:false});
Â  $('closeRank')Â  Â  .addEventListener('click', e=>{ e.preventDefault(); rankDlg.close(); }, {passive:false});

Â  // ===== åˆæœŸåŒ– =====
Â  setMuted(false);
Â  updateUnlockVisibility();
Â  // åˆæœŸæç”»ã‚‚å®‰å…¨ã«
Â  requestAnimationFrame(()=>{ resizeCanvas(); });

})();
</script>
</body>
</html>
